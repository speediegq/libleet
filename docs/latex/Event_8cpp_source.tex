\doxysection{Event.\+cpp}
\hypertarget{Event_8cpp_source}{}\label{Event_8cpp_source}\index{/home/speedie/libleet/src/Event.cpp@{/home/speedie/libleet/src/Event.cpp}}
\mbox{\hyperlink{Event_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ libleet}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Matrix\ client\ library\ written\ in\ C++}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Licensed\ under\ the\ GNU\ Affero\ General\ Public\ License\ version\ 3.}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ See\ included\ LICENSE\ file\ for\ more\ information.}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ https://git.speedie.site/speedie/libleet}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{keyword}{const}\ int32\_t\ \mbox{\hyperlink{namespaceleet_a422f2f5edf4183209f96b572cd0cbf73}{leet::returnUnixTimestamp}}()\ \{}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keywordflow}{return}\ std::chrono::duration\_cast<std::chrono::seconds>(std::chrono::system\_clock::now().time\_since\_epoch()).count();}
\DoxyCodeLine{00011\ \}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \mbox{\hyperlink{classleet_1_1Event_1_1Event}{leet::Event::Event}}\ \mbox{\hyperlink{namespaceleet_a70ad6031c50aef71041c68eb5bf1c415}{leet::returnEventFromTimestamp}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \mbox{\hyperlink{classleet_1_1Room_1_1Room}{leet::Room::Room}}*\ room,\ \textcolor{keyword}{const}\ int32\_t\ Timestamp,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ Direction)\ \{}
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00015\ \ \ \ \ \mbox{\hyperlink{classleet_1_1Event_1_1Event}{leet::Event::Event}}\ event;}
\DoxyCodeLine{00016\ \ \ \ \ std::string\ Dir\ =\ Direction\ ?\ \textcolor{stringliteral}{"{}f"{}}\ :\ \textcolor{stringliteral}{"{}b"{}};}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ =\ \mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{leet::invokeRequest\_Get}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v1/rooms/"{}}\ +\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}}\ +\ \textcolor{stringliteral}{"{}/timestamp\_to\_event"{}}\ +\ \textcolor{stringliteral}{"{}?ts="{}}\ +\ std::to\_string(Timestamp)\ +\ \textcolor{stringliteral}{"{}\&dir="{}}\ +\ Dir),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}});}
\DoxyCodeLine{00019\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ reqOutput\ =\ \{\ json::parse(Output)\ \};}
\DoxyCodeLine{00023\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ event;}
\DoxyCodeLine{00025\ \ \ \ \ \}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ reqOutput)\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}event\_id"{}}].is\_string())\ event.\mbox{\hyperlink{classleet_1_1Event_1_1Event_a44de14ebc615616045df5595c763522c}{eventID}}\ =\ output[\textcolor{stringliteral}{"{}event\_id"{}}].get<std::string>();}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}origin\_server\_ts"{}}].is\_number\_integer())\ event.\mbox{\hyperlink{classleet_1_1Event_1_1Event_a9c67e05cdae82f0c6f758cd80190133a}{Age}}\ =\ output[\textcolor{stringliteral}{"{}origin\_server\_ts"{}}].get<\textcolor{keywordtype}{int}>();}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00039\ \ \ \ \ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{return}\ event;}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{comment}{/*\ Return\ a\ sync\ class\ containing\ several\ things\ */}}
\DoxyCodeLine{00045\ \mbox{\hyperlink{classleet_1_1Sync_1_1Sync}{leet::Sync::Sync}}\ \mbox{\hyperlink{namespaceleet_aed2232388d75a5b6837200d3d3009acc}{leet::returnSync}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp)\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classleet_1_1Sync_1_1Sync}{leet::Sync::Sync}}\ sync;}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ =\ \mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{leet::invokeRequest\_Get}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/sync"{}}),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}});}
\DoxyCodeLine{00050\ \ \ \ \ json\ theOutput;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ theOutput\ =\ json::parse(Output);}
\DoxyCodeLine{00054\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sync;}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ sync.\mbox{\hyperlink{classleet_1_1Sync_1_1Sync_a2f7e58b985d4676bdb69cb69b6a9bbc8}{theRequest}}\ =\ theOutput;}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{auto}\&\ reqOutput\ =\ theOutput[\textcolor{stringliteral}{"{}to\_device"{}}][\textcolor{stringliteral}{"{}events"{}}];}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ reqOutput)\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession}{leet::Sync::megolmSession}}\ megolmSession;}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}sender\_key"{}}].is\_null())\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_aff7c3cbe5d689e39f1f883a3756a974c}{senderKey}}\ =\ output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}sender\_key"{}}];}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}algorithm"{}}].is\_null())\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_a83e4d359a3e4d40060358310b6dbcf49}{Algorithm}}\ =\ output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}algorithm"{}}];}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_aff7c3cbe5d689e39f1f883a3756a974c}{senderKey}}.compare(\textcolor{stringliteral}{"{}"{}}))\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}ciphertext"{}}][megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_aff7c3cbe5d689e39f1f883a3756a974c}{senderKey}}][\textcolor{stringliteral}{"{}body"{}}].is\_null())\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_a79a9a7f9811e4007d23f15e8b643ecf2}{cipherText}}\ =\ output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}ciphertext"{}}][megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_aff7c3cbe5d689e39f1f883a3756a974c}{senderKey}}][\textcolor{stringliteral}{"{}body"{}}];}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}ciphertext"{}}][megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_aff7c3cbe5d689e39f1f883a3756a974c}{senderKey}}][\textcolor{stringliteral}{"{}type"{}}].is\_null())\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_a7f9ca69710f886c5463994ace9bedace}{cipherType}}\ =\ output[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}ciphertext"{}}][megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_aff7c3cbe5d689e39f1f883a3756a974c}{senderKey}}][\textcolor{stringliteral}{"{}type"{}}];}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!output[\textcolor{stringliteral}{"{}sender"{}}].is\_null())\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_a9429f9a7f131f323e99decd2a498a779}{Sender}}\ =\ output[\textcolor{stringliteral}{"{}sender"{}}];}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!output[\textcolor{stringliteral}{"{}type"{}}].is\_null())\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ megolmSession.\mbox{\hyperlink{classleet_1_1Sync_1_1megolmSession_a1f7aacb252a7f5a51cb2720b0d521732}{Type}}\ =\ output[\textcolor{stringliteral}{"{}type"{}}];}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ sync.\mbox{\hyperlink{classleet_1_1Sync_1_1Sync_a4f8c5d3ffc58b636016fe620f6f80424}{megolmSessions}}.push\_back(megolmSession);}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{return}\ sync;}
\DoxyCodeLine{00092\ \}}

\end{DoxyCode}
