\doxysection{Login.\+cpp}
\hypertarget{Login_8cpp_source}{}\label{Login_8cpp_source}\index{/home/speedie/libleet/src/Login.cpp@{/home/speedie/libleet/src/Login.cpp}}
\mbox{\hyperlink{Login_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ libleet}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Matrix\ client\ library\ written\ in\ C++}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Licensed\ under\ the\ GNU\ Affero\ General\ Public\ License\ version\ 3.}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ See\ included\ LICENSE\ file\ for\ more\ information.}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ https://git.speedie.site/speedie/libleet}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ std::vector<std::string>\ \mbox{\hyperlink{namespaceleet_aa71e9add3fe71ad537065ebc2553e2ca}{leet::returnSupportedLoginTypes}}()\ \{}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00011\ \ \ \ \ std::vector<std::string>\ vector;}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ APIUrl\ \{\ \textcolor{stringliteral}{"{}/\_matrix/client/v3/login"{}}\ \};}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \ \ \ \ std::string\ Output\ \{\ \mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{leet::invokeRequest\_Get}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(APIUrl))\ \};}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ reqOutput\ =\ json::parse(Output);}
\DoxyCodeLine{00019\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ vector;}
\DoxyCodeLine{00021\ \ \ \ \ \}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keyword}{auto}\&\ messages\ =\ reqOutput[\textcolor{stringliteral}{"{}flows"{}}];}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ messages.begin();\ it\ !=\ messages.end();\ ++it)\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ std::string\ theString\{\};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/type"{}}\_json\_pointer))\ theString\ =\ it.value()[\textcolor{stringliteral}{"{}type"{}}];}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ vector.push\_back(theString);}
\DoxyCodeLine{00029\ \ \ \ \ \}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{return}\ vector;}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}\ \mbox{\hyperlink{namespaceleet_a6618277e9bd8b1c8dc6034a3e03135fd}{leet::refreshAccessToken}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp)\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}\ newResponse\ =\ *resp;}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{if}\ (!newResponse.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a0c193776bac32142e4b48034a45b7411}{refreshToken}}.compare(\textcolor{stringliteral}{"{}"{}}))\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ newResponse;}
\DoxyCodeLine{00040\ \ \ \ \ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ json\ body;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ body[\textcolor{stringliteral}{"{}refresh\_token"{}}]\ =\ newResponse.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a0c193776bac32142e4b48034a45b7411}{refreshToken}};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ json\ refreshOutput;}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ refreshOutput\ =\ \{\ json::parse(\mbox{\hyperlink{namespaceleet_aa88a91a144b2176d9ce3c4cad3c45bab}{leet::invokeRequest\_Post}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/refresh"{}}),\ body.dump()))\ \};}
\DoxyCodeLine{00050\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ newResponse;}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ refreshOutput)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}access\_token"{}}].is\_string())\ newResponse.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}}\ =\ output[\textcolor{stringliteral}{"{}access\_token"{}}].get<std::string>();}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}refresh\_token"{}}].is\_string())\ newResponse.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a0c193776bac32142e4b48034a45b7411}{refreshToken}}\ =\ output[\textcolor{stringliteral}{"{}refresh\_token"{}}].get<std::string>();}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}expires\_in\_ms"{}}].is\_number\_integer())\ newResponse.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a3373697c8735dc08e71d590da7ca6b6f}{Expiration}}\ =\ output[\textcolor{stringliteral}{"{}expires\_in\_ms"{}}].get<\textcolor{keywordtype}{int}>();}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{return}\ newResponse;}
\DoxyCodeLine{00068\ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceleet_a5a50820297b17118e6521b5b79d84fc1}{leet::checkRegistrationTokenValidity}}(\textcolor{keyword}{const}\ std::string\&\ Token)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ json\ body;}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ body\ =\ \{\ json::parse(\mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{leet::invokeRequest\_Get}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v1/register/m.login.registration\_token/validity?token="{}}\ +\ Token)))\ \};}
\DoxyCodeLine{00077\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ body)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}valid"{}}].is\_boolean())\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ theBool\ =\ output[\textcolor{stringliteral}{"{}valid"{}}].get<\textcolor{keywordtype}{bool}>();}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ theBool;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00094\ \ \ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}\ \mbox{\hyperlink{namespaceleet_a944df5761e8c6e43adf5b3b6f3b8976c}{leet::registerAccount}}(\mbox{\hyperlink{classleet_1_1User_1_1Credentials}{leet::User::Credentials}}*\ cred)\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}\ resp;}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ std::string\ theUsername\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ab69825910cc4796bd7992cd7cdfd6248}{Username}};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{if}\ (cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ab69825910cc4796bd7992cd7cdfd6248}{Username}}[0]\ ==\ \textcolor{charliteral}{'@'})\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ theUsername\ =\ \mbox{\hyperlink{namespaceleet_a9411e25fb1f3420d7b6c954926db536a}{leet::returnUserName}}(cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ab69825910cc4796bd7992cd7cdfd6248}{Username}});}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (theUsername[0]\ ==\ \textcolor{charliteral}{'@'}\ ||\ !theUsername.compare(\textcolor{stringliteral}{"{}"{}}))\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ resp;}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00112\ \ \ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ json\ body;}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{if}\ (cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ad6a50d9f239f3abfb0627617e19a91e1}{deviceID}}.compare(\textcolor{stringliteral}{"{}"{}}))\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ body[\textcolor{stringliteral}{"{}device\_id"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ad6a50d9f239f3abfb0627617e19a91e1}{deviceID}};}
\DoxyCodeLine{00118\ \ \ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ body[\textcolor{stringliteral}{"{}inhibit\_login"{}}]\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00121\ \ \ \ \ body[\textcolor{stringliteral}{"{}initial\_device\_display\_name"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_a14f30a55899e724877a84623378c00c8}{displayName}};}
\DoxyCodeLine{00122\ \ \ \ \ body[\textcolor{stringliteral}{"{}username"{}}]\ =\ theUsername;}
\DoxyCodeLine{00123\ \ \ \ \ body[\textcolor{stringliteral}{"{}password"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_a2601635196c112cc819b48449f143457}{Password}};}
\DoxyCodeLine{00124\ \ \ \ \ body[\textcolor{stringliteral}{"{}refresh\_token"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ae4d62ad39baa02795e11bf1daa74e12e}{refreshToken}};}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ json\ registerOutput;}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ registerOutput\ =\ \{\ json::parse(\mbox{\hyperlink{namespaceleet_aa88a91a144b2176d9ce3c4cad3c45bab}{leet::invokeRequest\_Post}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/register"{}}),\ body.dump()))\ \};}
\DoxyCodeLine{00130\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ resp;}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ registerOutput)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a9233923ddc9627b08b8572b2a379ae0c}{Homeserver}}\ =\ \mbox{\hyperlink{namespaceleet_a047ddd8c4f4dba43c5ee0e38858485ab}{leet::Homeserver}}\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_af93cb0d1ad2137e1c0d54cefa3418123}{Homeserver}};}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}access\_token"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}}\ =\ output[\textcolor{stringliteral}{"{}access\_token"{}}].get<std::string>();}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}device\_id"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a2c9bc29b7c1702af9c372fccd5e14c6d}{deviceID}}\ =\ output[\textcolor{stringliteral}{"{}device\_id"{}}].get<std::string>();}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}refresh\_token"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a0c193776bac32142e4b48034a45b7411}{refreshToken}}\ =\ output[\textcolor{stringliteral}{"{}refresh\_token"{}}].get<std::string>();}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}user\_id"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a7561824b6e56efae7257ac9995d43846}{userID}}\ =\ output[\textcolor{stringliteral}{"{}user\_id"{}}].get<std::string>();}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}expires\_in\_ms"{}}].is\_number\_integer())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a3373697c8735dc08e71d590da7ca6b6f}{Expiration}}\ =\ output[\textcolor{stringliteral}{"{}expires\_in\_ms"{}}].get<\textcolor{keywordtype}{int}>();}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00150\ \ \ \ \ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordflow}{return}\ resp;}
\DoxyCodeLine{00153\ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}\ \mbox{\hyperlink{namespaceleet_a95cd2b8c02fc7a1ef1e2878073a14b9e}{leet::loginAccount}}(\mbox{\hyperlink{classleet_1_1User_1_1Credentials}{leet::User::Credentials}}*\ cred)\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}\ resp;}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00158\ \ \ \ \ json\ list;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ std::string\ actualType\{\};}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{if}\ (cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_a319bf175ae5c1209abbb7c05199648d3}{Type}}\ ==\ \mbox{\hyperlink{libleet_8hpp_adf764cbdea00d65edcd07bb9953ad2b7acf9e9e1ff5162323074f7588e992b21e}{LEET\_TYPE\_TOKEN}})\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ actualType\ =\ \textcolor{stringliteral}{"{}m.login.token"{}};}
\DoxyCodeLine{00164\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ actualType\ =\ \textcolor{stringliteral}{"{}m.login.password"{}};}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{if}\ (cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ad6a50d9f239f3abfb0627617e19a91e1}{deviceID}}.compare(\textcolor{stringliteral}{"{}"{}}))\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}device\_id"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ad6a50d9f239f3abfb0627617e19a91e1}{deviceID}};}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ list[\textcolor{stringliteral}{"{}identifier"{}}][\textcolor{stringliteral}{"{}type"{}}]\ =\ \textcolor{stringliteral}{"{}m.id.user"{}};\ \textcolor{comment}{//\ Currently\ only\ supported\ method}}
\DoxyCodeLine{00173\ \ \ \ \ list[\textcolor{stringliteral}{"{}identifier"{}}][\textcolor{stringliteral}{"{}user"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ab69825910cc4796bd7992cd7cdfd6248}{Username}};}
\DoxyCodeLine{00174\ \ \ \ \ list[\textcolor{stringliteral}{"{}initial\_device\_display\_name"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_a14f30a55899e724877a84623378c00c8}{displayName}};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{if}\ (cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_a319bf175ae5c1209abbb7c05199648d3}{Type}}\ ==\ \mbox{\hyperlink{libleet_8hpp_adf764cbdea00d65edcd07bb9953ad2b7acf9e9e1ff5162323074f7588e992b21e}{LEET\_TYPE\_TOKEN}})\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}token"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_a60e506535df8e6672ea8e8ea7dff451e}{Token}};}
\DoxyCodeLine{00178\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}password"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_a2601635196c112cc819b48449f143457}{Password}};}
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ list[\textcolor{stringliteral}{"{}refresh\_token"{}}]\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_ae4d62ad39baa02795e11bf1daa74e12e}{refreshToken}};}
\DoxyCodeLine{00183\ \ \ \ \ list[\textcolor{stringliteral}{"{}type"{}}]\ =\ actualType;}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ json\ loginOutput\ =\ \{\ json::parse(\mbox{\hyperlink{namespaceleet_aa88a91a144b2176d9ce3c4cad3c45bab}{leet::invokeRequest\_Post}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/login"{}}),\ list.dump()))\ \};}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ loginOutput)\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a9233923ddc9627b08b8572b2a379ae0c}{Homeserver}}\ =\ \mbox{\hyperlink{namespaceleet_a047ddd8c4f4dba43c5ee0e38858485ab}{leet::Homeserver}}\ =\ cred-\/>\mbox{\hyperlink{classleet_1_1User_1_1Credentials_af93cb0d1ad2137e1c0d54cefa3418123}{Homeserver}};}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}access\_token"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}}\ =\ output[\textcolor{stringliteral}{"{}access\_token"{}}].get<std::string>();}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}device\_id"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a2c9bc29b7c1702af9c372fccd5e14c6d}{deviceID}}\ =\ output[\textcolor{stringliteral}{"{}device\_id"{}}].get<std::string>();}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}refresh\_token"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a0c193776bac32142e4b48034a45b7411}{refreshToken}}\ =\ output[\textcolor{stringliteral}{"{}refresh\_token"{}}].get<std::string>();}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}user\_id"{}}].is\_string())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a7561824b6e56efae7257ac9995d43846}{userID}}\ =\ output[\textcolor{stringliteral}{"{}user\_id"{}}].get<std::string>();}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}expires\_in\_ms"{}}].is\_number\_integer())\ resp.\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a3373697c8735dc08e71d590da7ca6b6f}{Expiration}}\ =\ output[\textcolor{stringliteral}{"{}expires\_in\_ms"{}}].get<\textcolor{keywordtype}{int}>();}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordflow}{return}\ resp;}
\DoxyCodeLine{00206\ \}}

\end{DoxyCode}
