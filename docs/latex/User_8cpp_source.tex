\doxysection{User.\+cpp}
\hypertarget{User_8cpp_source}{}\label{User_8cpp_source}\index{/home/speedie/libleet/src/User.cpp@{/home/speedie/libleet/src/User.cpp}}
\mbox{\hyperlink{User_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ libleet}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Matrix\ client\ library\ written\ in\ C++}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Licensed\ under\ the\ GNU\ Affero\ General\ Public\ License\ version\ 3.}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ See\ included\ LICENSE\ file\ for\ more\ information.}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ https://git.speedie.site/speedie/libleet}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{comment}{/*\ Converts\ a\ username\ to\ a\ proper\ user\ ID\ if\ necessary\ (i.e.\ speedie\ -\/>\ @speedie:matrix.org)\ */}}
\DoxyCodeLine{00010\ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{namespaceleet_a7f18808fb4942a066467af4da81de7fe}{leet::findUserID}}(\textcolor{keyword}{const}\ std::string\&\ Alias,\ \textcolor{keyword}{const}\ std::string\&\ Homeserver)\ \{}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{keywordflow}{if}\ (Alias[0]\ !=\ \textcolor{charliteral}{'@'})}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}@"{}}\ +\ Alias\ +\ \textcolor{stringliteral}{"{}:"{}}\ +\ \mbox{\hyperlink{namespaceleet_a047ddd8c4f4dba43c5ee0e38858485ab}{Homeserver}};}
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{keywordflow}{return}\ Alias;}
\DoxyCodeLine{00014\ \}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{comment}{/*\ leet::findUserID\ in\ reverse\ */}}
\DoxyCodeLine{00017\ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{namespaceleet_a9411e25fb1f3420d7b6c954926db536a}{leet::returnUserName}}(\textcolor{keyword}{const}\ std::string\&\ userID)\ \{}
\DoxyCodeLine{00018\ \ \ \ \ std::string\ str;}
\DoxyCodeLine{00019\ \ \ \ \ std::regex\ pattern\{\textcolor{stringliteral}{"{}@([\string^:]+):"{}}\};}
\DoxyCodeLine{00020\ \ \ \ \ std::smatch\ reg;}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keywordflow}{if}\ (std::regex\_search(userID,\ reg,\ pattern))\ \textcolor{keywordflow}{return}\ reg[1].str();}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordflow}{return}\ str;}
\DoxyCodeLine{00023\ \}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{comment}{/*\ Returns\ a\ leet::User::Profile\ class\ containing\ things\ such\ as\ display\ name\ and\ avatar\ URL\ */}}
\DoxyCodeLine{00026\ \mbox{\hyperlink{classleet_1_1User_1_1Profile}{leet::User::Profile}}\ \mbox{\hyperlink{namespaceleet_a05c6e7d0d0a4ca3117c9cd7fffb0c6cd}{leet::getUserData}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \textcolor{keyword}{const}\ std::string\&\ userID)\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00028\ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00029\ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1Profile}{leet::User::Profile}}\ profile;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{if}\ (userID[0]\ !=\ \textcolor{charliteral}{'@'})\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ profile;}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_ad9a9c118c09885e9020674b7826756f8}{userID}}\ =\ \mbox{\hyperlink{namespaceleet_a7f18808fb4942a066467af4da81de7fe}{leet::findUserID}}(userID,\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a9233923ddc9627b08b8572b2a379ae0c}{Homeserver}});}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{if}\ (profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_ad9a9c118c09885e9020674b7826756f8}{userID}}.empty())\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ \textcolor{stringliteral}{"{}Failed\ to\ get\ User\ ID"{}};}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ profile;}
\DoxyCodeLine{00041\ \ \ \ \ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ API\ \{\ \mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/profile/"{}}\ +\ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_ad9a9c118c09885e9020674b7826756f8}{userID}})\ \};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ =\ \mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{invokeRequest\_Get}}(API);}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ reqOutput\ =\ \{\ json::parse(Output)\ \};}
\DoxyCodeLine{00050\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ profile;}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ reqOutput)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}avatar\_url"{}}].is\_string())\ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_aca64ad4120289dad0d55c623ff3d0ac5}{avatarURL}}\ =\ output[\textcolor{stringliteral}{"{}avatar\_url"{}}].get<std::string>();}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}displayname"{}}].is\_string())\ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_a682c1db4b7f50f3aad4e6b6c08c557a1}{displayName}}\ =\ output[\textcolor{stringliteral}{"{}displayname"{}}].get<std::string>();}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1Profile}{leet::User::Profile}}\ userProfile;}
\DoxyCodeLine{00066\ \ \ \ \ userProfile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_ad9a9c118c09885e9020674b7826756f8}{userID}}\ =\ userID;}
\DoxyCodeLine{00067\ \ \ \ \ std::vector<leet::User::Profile>\ User\ =\ \{\ userProfile\ \};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_a2adeec50cb835a6977e971ff54064db2}{Devices}}\ =\ \mbox{\hyperlink{namespaceleet_a196d23dcf6a4e5645af44cd94c59cb48}{leet::returnDevicesFromUser}}(resp,\ User);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{return}\ profile;}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{comment}{/*\ Returns\ an\ array\ of\ all\ devices\ for\ a\ user\ */}}
\DoxyCodeLine{00075\ \textcolor{keyword}{const}\ std::vector<leet::User::Device>\ \mbox{\hyperlink{namespaceleet_a196d23dcf6a4e5645af44cd94c59cb48}{leet::returnDevicesFromUser}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \textcolor{keyword}{const}\ std::vector<leet::User::Profile>\&\ user)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ std::vector<leet::User::Device>\ devices;}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ json\ Body;}
\DoxyCodeLine{00080\ \ \ \ \ json\ deviceKeys;}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ theUser\ :\ user)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ deviceKeys[theUser.userID]\ =\ json::array();}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ Body[\textcolor{stringliteral}{"{}device\_keys"{}}]\ =\ deviceKeys;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ Body[\textcolor{stringliteral}{"{}timeout"{}}]\ =\ 10000;}
\DoxyCodeLine{00086\ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ =\ \mbox{\hyperlink{namespaceleet_aa88a91a144b2176d9ce3c4cad3c45bab}{leet::invokeRequest\_Post}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/keys/query"{}}),\ Body.dump(),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}});}
\DoxyCodeLine{00089\ \ \ \ \ json\ returnOutput;}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ returnOutput\ =\ json::parse(Output);}
\DoxyCodeLine{00093\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ devices;}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ userID\ :\ user)\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ deviceList\ =\ returnOutput[\textcolor{stringliteral}{"{}device\_keys"{}}][userID.userID];}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ deviceList.begin();\ it\ !=\ deviceList.end();\ ++it)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1Device}{leet::User::Device}}\ device;}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_a0fb0c5d9b1f6f9e358380c47bf8c27b6}{userID}}\ =\ userID.userID;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af1f19ee3d41ea38ddba0f469734ccf1f}{deviceID}}\ =\ it.key();}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ json::json\_pointer\ curve25519Pointer(\textcolor{stringliteral}{"{}/keys/curve25519:"{}}\ +\ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af1f19ee3d41ea38ddba0f469734ccf1f}{deviceID}});}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(curve25519Pointer))\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_abae3e799bf2e2b392827ff83f9280220}{curve25519Key}}\ =\ it.value()[\textcolor{stringliteral}{"{}keys"{}}][\textcolor{stringliteral}{"{}curve25519:"{}}\ +\ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af1f19ee3d41ea38ddba0f469734ccf1f}{deviceID}}];}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ json::json\_pointer\ ed25519Pointer(\textcolor{stringliteral}{"{}/keys/ed25519:"{}}\ +\ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af1f19ee3d41ea38ddba0f469734ccf1f}{deviceID}});}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(ed25519Pointer))\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_a6de003ef59747f0d64f391cca9479390}{ed25519Key}}\ =\ it.value()[\textcolor{stringliteral}{"{}keys"{}}][\textcolor{stringliteral}{"{}ed25519:"{}}\ +\ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af1f19ee3d41ea38ddba0f469734ccf1f}{deviceID}}];}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ json::json\_pointer\ ed25519SigPointer(\textcolor{stringliteral}{"{}/signatures/"{}}\ +\ userID.userID\ +\ \textcolor{stringliteral}{"{}/ed25519:"{}}\ +\ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af1f19ee3d41ea38ddba0f469734ccf1f}{deviceID}});}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(ed25519SigPointer))\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_a31b2b73e0920a4c8a2c31c06e8c14612}{ed25519Signature}}\ =\ it.value()[\textcolor{stringliteral}{"{}signatures"{}}][userID.userID][\textcolor{stringliteral}{"{}ed25519:"{}}\ +\ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af1f19ee3d41ea38ddba0f469734ccf1f}{deviceID}}];}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/unsigned/device\_display\_name"{}}\_json\_pointer))\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_ae3eb4a922db791eb92264ef9656febd5}{deviceDisplayName}}\ =\ it.value()[\textcolor{stringliteral}{"{}unsigned"{}}][\textcolor{stringliteral}{"{}device\_display\_name"{}}];}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af848c7b87bb41ab7c3d3c6f57b5fd667}{olm}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_acae68e9559f1baf239fa0efd2a84d35f}{megolm}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::find(it.value()[\textcolor{stringliteral}{"{}algorithms"{}}].begin(),\ it.value()[\textcolor{stringliteral}{"{}algorithms"{}}].end(),\ \textcolor{stringliteral}{"{}m.olm.v1.curve25519-\/aes-\/sha2"{}})\ !=\ it.value()[\textcolor{stringliteral}{"{}algorithms"{}}].end())}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_af848c7b87bb41ab7c3d3c6f57b5fd667}{olm}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::find(it.value()[\textcolor{stringliteral}{"{}algorithms"{}}].begin(),\ it.value()[\textcolor{stringliteral}{"{}algorithms"{}}].end(),\ \textcolor{stringliteral}{"{}m.megolm.v1.aes-\/sha2"{}})\ !=\ it.value()[\textcolor{stringliteral}{"{}algorithms"{}}].end())}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device.\mbox{\hyperlink{classleet_1_1User_1_1Device_acae68e9559f1baf239fa0efd2a84d35f}{megolm}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ devices.push\_back(device);}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordflow}{return}\ devices;}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \textcolor{comment}{/*\ Returns\ true\ if\ username\ is\ valid\ and\ available\ for\ registering\ */}}
\DoxyCodeLine{00139\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceleet_a4aab99007c2c99bb6231484636d71ead}{leet::checkIfUsernameIsAvailable}}(\textcolor{keyword}{const}\ std::string\&\ Username)\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ std::string\ theUsername\ =\ Username;}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{if}\ (Username[0]\ ==\ \textcolor{charliteral}{'@'})\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ theUsername\ =\ \mbox{\hyperlink{namespaceleet_a9411e25fb1f3420d7b6c954926db536a}{leet::returnUserName}}(Username);}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (theUsername[0]\ ==\ \textcolor{charliteral}{'@'}\ ||\ !theUsername.compare(\textcolor{stringliteral}{"{}"{}}))\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ API\ \{\ \mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/register/available?username="{}}\ +\ theUsername)\ \};}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ =\ \mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{invokeRequest\_Get}}(API);}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ reqOutput\ =\ \{\ json::parse(Output)\ \};}
\DoxyCodeLine{00161\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ fallback\ to\ false\ is\ probably\ safest?}}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ reqOutput)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}available"{}}].is\_boolean())\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ output[\textcolor{stringliteral}{"{}available"{}}].get<\textcolor{keywordtype}{bool}>();}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00179\ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \textcolor{comment}{/*\ Returns\ an\ array\ of\ all\ users\ in\ a\ room\ */}}
\DoxyCodeLine{00182\ \textcolor{keyword}{const}\ std::vector<leet::User::Profile>\ \mbox{\hyperlink{namespaceleet_a00a66e98469fbf8978fc3face0deb78a}{leet::returnUsersInRoom}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \mbox{\hyperlink{classleet_1_1Room_1_1Room}{leet::Room::Room}}*\ room)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00184\ \ \ \ \ std::vector<leet::User::Profile>\ vector;}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ =\ \mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{leet::invokeRequest\_Get}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(\textcolor{stringliteral}{"{}/\_matrix/client/v3/rooms/"{}}\ +\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}}\ +\ \textcolor{stringliteral}{"{}/joined\_members"{}}),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}});}
\DoxyCodeLine{00187\ \ \ \ \ json\ returnOutput;}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ returnOutput\ =\ json::parse(Output);}
\DoxyCodeLine{00191\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ vector;}
\DoxyCodeLine{00193\ \ \ \ \ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keyword}{auto}\&\ users\ =\ returnOutput[\textcolor{stringliteral}{"{}joined"{}}];}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ users.begin();\ it\ !=\ users.end();\ ++it)\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1Profile}{leet::User::Profile}}\ profile;}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}avatar\_url"{}})\ \&\&\ !it.value()[\textcolor{stringliteral}{"{}avatar\_url"{}}].is\_null())\ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_aca64ad4120289dad0d55c623ff3d0ac5}{avatarURL}}\ =\ it.value()[\textcolor{stringliteral}{"{}avatar\_url"{}}];}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}display\_name"{}})\ \&\&\ !it.value()[\textcolor{stringliteral}{"{}display\_name"{}}].is\_null())\ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_a682c1db4b7f50f3aad4e6b6c08c557a1}{displayName}}\ =\ it.value()[\textcolor{stringliteral}{"{}display\_name"{}}];}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_ad9a9c118c09885e9020674b7826756f8}{userID}}\ =\ it.key();}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classleet_1_1User_1_1Profile}{leet::User::Profile}}\ userProfile;}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ userProfile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_ad9a9c118c09885e9020674b7826756f8}{userID}}\ =\ it.key();}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ std::vector<leet::User::Profile>\ User\ =\ \{\ userProfile\ \};}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ profile.\mbox{\hyperlink{classleet_1_1User_1_1Profile_a2adeec50cb835a6977e971ff54064db2}{Devices}}\ =\ \mbox{\hyperlink{namespaceleet_a196d23dcf6a4e5645af44cd94c59cb48}{leet::returnDevicesFromUser}}(resp,\ User);}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ vector.push\_back(profile);}
\DoxyCodeLine{00211\ \ \ \ \ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keywordflow}{return}\ vector;}
\DoxyCodeLine{00214\ \}}

\end{DoxyCode}
