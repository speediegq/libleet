\doxysection{Message.\+cpp}
\hypertarget{Message_8cpp_source}{}\label{Message_8cpp_source}\index{/home/speedie/libleet/src/Message.cpp@{/home/speedie/libleet/src/Message.cpp}}
\mbox{\hyperlink{Message_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ libleet}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Matrix\ client\ library\ written\ in\ C++}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Licensed\ under\ the\ GNU\ Affero\ General\ Public\ License\ version\ 3.}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ See\ included\ LICENSE\ file\ for\ more\ information.}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ https://git.speedie.site/speedie/libleet}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceleet_a67dbc8b27a77c92ce074b2ab6ae47850}{leet::sendMessage}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \mbox{\hyperlink{classleet_1_1Room_1_1Room}{leet::Room::Room}}*\ room,\ \mbox{\hyperlink{classleet_1_1Message_1_1Message}{leet::Message::Message}}*\ msg)\ \{}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceleet_adc8712b33d096d2f8a204e7bad8ed1d4}{TransID}}\ \{\ \mbox{\hyperlink{namespaceleet_adc8712b33d096d2f8a204e7bad8ed1d4}{leet::TransID}}\ \};}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ eventType\ \{\ \textcolor{stringliteral}{"{}m.room.message"{}}\ \};}
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ APIUrl\ \{\ \textcolor{stringliteral}{"{}/\_matrix/client/v3/rooms/"{}}\ +\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}}\ +\ \textcolor{stringliteral}{"{}/send/"{}}\ +\ eventType\ +\ \textcolor{stringliteral}{"{}/"{}}\ +\ std::to\_string(\mbox{\hyperlink{namespaceleet_adc8712b33d096d2f8a204e7bad8ed1d4}{TransID}})\ \};}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \ \ \ \ json\ list;}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keywordflow}{if}\ (!msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}}.compare(\textcolor{stringliteral}{"{}m.image"{}})\ ||\ !msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}}.compare(\textcolor{stringliteral}{"{}m.audio"{}})\ ||\ !msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}}.compare(\textcolor{stringliteral}{"{}m.video"{}})\ ||\ !msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}}.compare(\textcolor{stringliteral}{"{}m.file"{}}))\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_a89b2bfdce96b93c066b5f565c6a0074a}{attachmentURL}}[0]\ !=\ \textcolor{charliteral}{'m'}\ ||\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_a89b2bfdce96b93c066b5f565c6a0074a}{attachmentURL}}[1]\ !=\ \textcolor{charliteral}{'x'}\ ||\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_a89b2bfdce96b93c066b5f565c6a0074a}{attachmentURL}}[2]\ !=\ \textcolor{charliteral}{'c'})\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}type"{}}]\ =\ \textcolor{stringliteral}{"{}m.room.message"{}};}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}room\_id"{}}]\ =\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}};}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}body"{}}]\ =\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_a74739e3eeb0bca60a6c0285af5c642bb}{messageText}};}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}msgtype"{}}]\ =\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}url"{}}]\ =\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_a89b2bfdce96b93c066b5f565c6a0074a}{attachmentURL}};}
\DoxyCodeLine{00028\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}type"{}}]\ =\ \textcolor{stringliteral}{"{}m.room.message"{}};}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}room\_id"{}}]\ =\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}};}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}body"{}}]\ =\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_a74739e3eeb0bca60a6c0285af5c642bb}{messageText}};}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}msgtype"{}}]\ =\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}};}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ \{\ \mbox{\hyperlink{namespaceleet_aa3853464d166cde6fa97f8dfb9e2398f}{leet::invokeRequest\_Put}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(APIUrl),\ list.dump(),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}})\ \};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ reqOutput\ =\ \{\ json::parse(Output)\ \};}
\DoxyCodeLine{00040\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00042\ \ \ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ reqOutput)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#ifndef\ LEET\_NO\_ENCRYPTION}}
\DoxyCodeLine{00056\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceleet_a40c1e3b3d1988d56aaa389607d10fe57}{leet::sendEncryptedMessage}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \mbox{\hyperlink{classleet_1_1Encryption}{leet::Encryption}}*\ enc,\ \mbox{\hyperlink{classleet_1_1Room_1_1Room}{leet::Room::Room}}*\ room,\ \mbox{\hyperlink{classleet_1_1Message_1_1Message}{leet::Message::Message}}*\ msg)\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceleet_adc8712b33d096d2f8a204e7bad8ed1d4}{TransID}}\ \{\ \mbox{\hyperlink{namespaceleet_adc8712b33d096d2f8a204e7bad8ed1d4}{leet::TransID}}\ \};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ eventType\ \{\ \textcolor{stringliteral}{"{}m.room.encrypted"{}}\ \};}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ APIUrl\ \{\ \textcolor{stringliteral}{"{}/\_matrix/client/v3/rooms/"{}}\ +\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}}\ +\ \textcolor{stringliteral}{"{}/send/"{}}\ +\ eventType\ +\ \textcolor{stringliteral}{"{}/"{}}\ +\ std::to\_string(\mbox{\hyperlink{namespaceleet_adc8712b33d096d2f8a204e7bad8ed1d4}{TransID}})\ \};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ json\ Body;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ Body[\textcolor{stringliteral}{"{}type"{}}]\ =\ \textcolor{stringliteral}{"{}m.room.message"{}};}
\DoxyCodeLine{00065\ \ \ \ \ Body[\textcolor{stringliteral}{"{}room\_id"{}}]\ =\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}};}
\DoxyCodeLine{00066\ \ \ \ \ Body[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}body"{}}]\ =\ msg-\/>\mbox{\hyperlink{classleet_1_1Message_1_1Message_a74739e3eeb0bca60a6c0285af5c642bb}{messageText}};}
\DoxyCodeLine{00067\ \ \ \ \ Body[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}msgtype"{}}]\ =\ \textcolor{stringliteral}{"{}m.text"{}};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ Output\ \{\ \mbox{\hyperlink{namespaceleet_aa3853464d166cde6fa97f8dfb9e2398f}{leet::invokeRequest\_Put}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(APIUrl),\ enc-\/>\mbox{\hyperlink{classleet_1_1Encryption_abe9300b67a75daedf15ff2a3d08540d6}{account}}.\mbox{\hyperlink{classleet_1_1olmAccount_ab5422499f6fcef344d157f7d74cfffb8}{encryptMessage}}(resp,\ Body.dump()),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}})\ \};}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ reqOutput\ =\ \{\ json::parse(Output)\ \};}
\DoxyCodeLine{00074\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ reqOutput)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}errcode"{}}].is\_string())\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 1;}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_ae7fadb8f554b82e37512ece5f451e345}{leet::Error}}\ =\ output[\textcolor{stringliteral}{"{}errcode"{}}].get<std::string>();}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}error"{}}].is\_string())\ \mbox{\hyperlink{namespaceleet_aca8cf23cb2471b07f1ee22a2077b5b37}{leet::friendlyError}}\ =\ output[\textcolor{stringliteral}{"{}error"{}}].get<std::string>();}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \ \ \}}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{keyword}{const}\ std::vector<leet::Message::Message>\ \mbox{\hyperlink{namespaceleet_a877400ed8e1e79c183a8f7858d79446d}{leet::returnMessages}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \mbox{\hyperlink{classleet_1_1Room_1_1Room}{leet::Room::Room}}*\ room,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ messageCount)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00092\ \ \ \ \ std::vector<leet::Message::Message>\ vector;}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ APIUrl\ \{\ \textcolor{stringliteral}{"{}/\_matrix/client/v3/rooms/"{}}\ +\ room-\/>\mbox{\hyperlink{classleet_1_1Room_1_1Room_a845bb4727d6c821e8d69a15ad0e2eb1f}{roomID}}\ +\ \textcolor{stringliteral}{"{}/messages?dir=b\&limit="{}}\ +\ std::to\_string(messageCount)\ \};}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ std::string\ Output\ \{\ \mbox{\hyperlink{namespaceleet_a87681d6edf2064da9cf4df3dcb3ac67e}{leet::invokeRequest\_Get}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(APIUrl),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}})\ \};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ reqOutput\ =\ json::parse(Output);}
\DoxyCodeLine{00100\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ vector;}
\DoxyCodeLine{00102\ \ \ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{auto}\&\ messages\ =\ reqOutput[\textcolor{stringliteral}{"{}chunk"{}}];}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ messages.begin();\ it\ !=\ messages.end();\ ++it)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classleet_1_1Message_1_1Message}{leet::Message::Message}}\ message;}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_ab76d63f5dc59c42f6dc465cf9071f664}{Encrypted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/type"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a4671a0906f0a44c788f8e5b8c82016e6}{Type}}\ =\ it.value()[\textcolor{stringliteral}{"{}type"{}}];}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Encrypted\ message}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a4671a0906f0a44c788f8e5b8c82016e6}{Type}}.compare(\textcolor{stringliteral}{"{}m.room.encrypted"{}}))\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_ab76d63f5dc59c42f6dc465cf9071f664}{Encrypted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a35e1fbf4f63b29a16f0a6bb1e9de51e8}{megolm}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/ciphertext"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a9cdf1012eeeaff58c86fd1ea156a656b}{cipherText}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}ciphertext"{}}];}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/sender\_key"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a9280e4ed8e1ec6ed3591ac75bb341531}{senderKey}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}sender\_key"{}}];}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/device\_id"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_af257e013a8faa42727367a54873615e3}{deviceID}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}device\_id"{}}];}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/session\_id"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_adaeaa3d24938167e2ce791ea21c9c450}{sessionID}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}session\_id"{}}];}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/algorithm"{}}\_json\_pointer))\ \textcolor{keywordflow}{if}\ (it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}algorithm"{}}]\ ==\ \textcolor{stringliteral}{"{}m.megolm.v1.aes-\/sha2"{}})\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a35e1fbf4f63b29a16f0a6bb1e9de51e8}{megolm}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/msgtype"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}msgtype"{}}];}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/sender"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_af5b9b84cdc8ee474c5acb47b7e632bb8}{Sender}}\ =\ it.value()[\textcolor{stringliteral}{"{}sender"{}}];}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/body"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a74739e3eeb0bca60a6c0285af5c642bb}{messageText}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}body"{}}];}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/formatted\_body"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a83fed20f25325d55a89b41169dd24280}{formattedText}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}formatted\_body"{}}];}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/format"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a8dd019876adbaa08129661604f493131}{Format}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}format"{}}];}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/mimetype"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_aa81bf1eca55789a987565da2497d67ab}{mimeType}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}mimetype"{}}];}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/event\_id"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a00407d68662527759fd2404d285f7b82}{eventID}}\ =\ it.value()[\textcolor{stringliteral}{"{}event\_id"{}}];}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/origin\_server\_ts"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a28b5c363010fd021f2f1605522258889}{Age}}\ =\ it.value()[\textcolor{stringliteral}{"{}origin\_server\_ts"{}}];}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Attachments}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/size"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_aa0c3f9c7ee665698987b7ad4f3b23040}{attachmentSize}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}size"{}}];}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/duration"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_acc12eccb366d62e626c48d707557bd15}{attachmentLength}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}duration"{}}];}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/w"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a99366bce597aa139f1ab01420a0061bf}{attachmentWidth}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}w"{}}];}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/h"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a80a089d0765fb792ca1472f400170c51}{attachmentHeight}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}h"{}}];}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/url"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a89b2bfdce96b93c066b5f565c6a0074a}{attachmentURL}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}url"{}}];}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Handle\ thumbnails}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_acf6d509850c3827076a63a9fc7320a6e}{messageType}}.compare(\textcolor{stringliteral}{"{}m.video"{}}))\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/thumbnail\_info/w"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a09401ecd78d0e5b06290adf2acf11e28}{thumbnailWidth}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}thumbnail\_info"{}}][\textcolor{stringliteral}{"{}w"{}}];}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/thumbnail\_info/h"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a9991e5daa3476527eed8b140ba99d61e}{thumbnailHeight}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}thumbnail\_info"{}}][\textcolor{stringliteral}{"{}h"{}}];}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/thumbnail\_info/size"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_aad48127d5068692876945e050d3968ed}{thumbnailSize}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}thumbnail\_info"{}}][\textcolor{stringliteral}{"{}size"{}}];}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/thumbnail\_info/mimetype"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_aac353fb22826eed5757682ea3378eb02}{thumbnailMimeType}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}thumbnail\_info"{}}][\textcolor{stringliteral}{"{}mimetype"{}}];}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it.value().contains(\textcolor{stringliteral}{"{}/content/info/thumbnail\_url"{}}\_json\_pointer))\ message.\mbox{\hyperlink{classleet_1_1Message_1_1Message_a5264e3e6694c7c06960a885d1c7fe49b}{thumbnailURL}}\ =\ it.value()[\textcolor{stringliteral}{"{}content"{}}][\textcolor{stringliteral}{"{}info"{}}][\textcolor{stringliteral}{"{}thumbnail\_url"{}}];}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ vector.push\_back(message);}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{return}\ vector;}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{namespaceleet_a56a1a90994bbd897072fb1b902abc993}{leet::returnFilter}}(\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse}{leet::User::CredentialsResponse}}*\ resp,\ \mbox{\hyperlink{classleet_1_1Filter_1_1Filter}{leet::Filter::Filter}}\ *filter)\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ APIUrl\ \{\ \textcolor{stringliteral}{"{}/\_matrix/client/v3/user/"{}}\ +\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_a7561824b6e56efae7257ac9995d43846}{userID}}\ +\ \textcolor{stringliteral}{"{}/filter"{}}\ \};}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ json\ list;}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ list[\textcolor{stringliteral}{"{}event\_format"{}}]\ =\ \textcolor{stringliteral}{"{}client"{}};}
\DoxyCodeLine{00164\ \ \ \ \ list[\textcolor{stringliteral}{"{}event\_fields"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a24cf8c59760cf7fd021bf3fe8ccc641f}{Fields}};}
\DoxyCodeLine{00165\ \ \ \ \ list[\textcolor{stringliteral}{"{}presence"{}}][\textcolor{stringliteral}{"{}senders"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a5e1ade5b1170491596260d53ed0194bb}{Senders}};}
\DoxyCodeLine{00166\ \ \ \ \ list[\textcolor{stringliteral}{"{}presence"{}}][\textcolor{stringliteral}{"{}not\_senders"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a6a512538ce1f23a0c035e5120c392505}{notSenders}};}
\DoxyCodeLine{00167\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}ephemeral"{}}][\textcolor{stringliteral}{"{}rooms"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_abd1a9e177b61b8106d8ec73c5be56860}{Rooms}};}
\DoxyCodeLine{00168\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}ephemeral"{}}][\textcolor{stringliteral}{"{}not\_rooms"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_ac0beebf520feb5041a0a74ec38c0aff5}{notRooms}};}
\DoxyCodeLine{00169\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}ephemeral"{}}][\textcolor{stringliteral}{"{}senders"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a5e1ade5b1170491596260d53ed0194bb}{Senders}};}
\DoxyCodeLine{00170\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}ephemeral"{}}][\textcolor{stringliteral}{"{}not\_senders"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a6a512538ce1f23a0c035e5120c392505}{notSenders}};}
\DoxyCodeLine{00171\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}state"{}}][\textcolor{stringliteral}{"{}rooms"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_abd1a9e177b61b8106d8ec73c5be56860}{Rooms}};}
\DoxyCodeLine{00172\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}state"{}}][\textcolor{stringliteral}{"{}not\_rooms"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_ac0beebf520feb5041a0a74ec38c0aff5}{notRooms}};}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordflow}{if}\ (filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a18347996b1227a4c7a3d328d184ba3da}{Limit}}\ !=\ 0)\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}timeline"{}}][\textcolor{stringliteral}{"{}limit"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a18347996b1227a4c7a3d328d184ba3da}{Limit}};}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}timeline"{}}][\textcolor{stringliteral}{"{}not\_rooms"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_ac0beebf520feb5041a0a74ec38c0aff5}{notRooms}};}
\DoxyCodeLine{00179\ \ \ \ \ list[\textcolor{stringliteral}{"{}room"{}}][\textcolor{stringliteral}{"{}timeline"{}}][\textcolor{stringliteral}{"{}not\_senders"{}}]\ =\ filter-\/>\mbox{\hyperlink{classleet_1_1Filter_1_1Filter_a6a512538ce1f23a0c035e5120c392505}{notSenders}};}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ std::string\ Output\ \{\ \mbox{\hyperlink{namespaceleet_aa88a91a144b2176d9ce3c4cad3c45bab}{leet::invokeRequest\_Post}}(\mbox{\hyperlink{namespaceleet_abf8deb3b48c9f7322aa6654885946738}{leet::getAPI}}(APIUrl),\ list.dump(),\ resp-\/>\mbox{\hyperlink{classleet_1_1User_1_1CredentialsResponse_ae4d15192559f009ad966de4bc9cdf58a}{accessToken}})\ \};}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ json\ reqOutput;}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ reqOutput\ =\ json::parse(Output);}
\DoxyCodeLine{00186\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ json::parse\_error\&\ e)\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ output\ :\ reqOutput)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceleet_aa20a9fa2de98421d60165559a8a23f76}{leet::errorCode}}\ =\ 0;}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output[\textcolor{stringliteral}{"{}filter\_id"{}}].is\_string())\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ output[\textcolor{stringliteral}{"{}filter\_id"{}}].get<std::string>();}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00199\ \}}

\end{DoxyCode}
